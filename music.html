<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>éŸ³ä¹åŒº - å¤©é©¬è¡Œç©ºåˆ›æ„ç½‘</title>
    <link rel="icon" href="photo/logo.png" type="image/png">
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* éŸ³ä¹åŒºæ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        
        .container {
            width: 100%;
            max-width: 480px;
            margin: 0 auto;
        }
        
        /* éŸ³ä¹æœç´¢åŒº */
        .music-search {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .search-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
            color: #667eea;
        }
        
        .search-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-label {
            font-size: 14px;
            font-weight: 500;
            color: #555;
        }
        
        .form-input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .search-btn {
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .search-btn:active {
            transform: translateY(0);
        }
        
        /* éŸ³ä¹æ’­æ”¾å™¨æ ·å¼ */
        .music-player {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .music-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .music-cover {
            width: 200px;
            height: 200px;
            border-radius: 12px;
            object-fit: cover;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            margin-bottom: 15px;
        }
        
        .music-title {
            font-size: 20px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 8px;
            color: #333;
        }
        
        .music-artist {
            font-size: 16px;
            color: #666;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .music-level {
            font-size: 14px;
            color: #999;
            background: #f0f0f0;
            padding: 4px 12px;
            border-radius: 12px;
        }
        
        /* æ’­æ”¾æ§åˆ¶åŒºåŸŸ */
        .playback-controls {
            margin: 20px 0;
        }
        
        .progress-container {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            cursor: pointer;
            margin-bottom: 15px;
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s ease;
        }
        
        .progress-handle {
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 14px;
            height: 14px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 50%;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .progress-container:hover .progress-handle {
            opacity: 1;
        }
        
        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #999;
            margin-bottom: 20px;
        }
        
        .control-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .control-btn {
            background: #f0f0f0;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: #e0e0e0;
            transform: scale(1.1);
        }
        
        .play-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 60px;
            height: 60px;
            font-size: 24px;
        }
        
        .play-btn:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6b429a 100%);
            transform: scale(1.1);
        }
        
        /* æ­Œè¯æ ·å¼ */
        .lyrics-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .lyrics-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
            color: #333;
        }
        
        .lyrics {
            font-size: 14px;
            line-height: 2;
            text-align: center;
            color: #666;
        }
        
        .lyric-line {
            margin: 5px 0;
            transition: all 0.3s ease;
        }
        
        .lyric-line.active {
            color: #667eea;
            font-size: 16px;
            font-weight: 600;
            transform: scale(1.05);
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .loading.show {
            display: block;
        }
        
        /* é”™è¯¯ä¿¡æ¯æ ·å¼ */
        .error-message {
            background: #fff2f0;
            color: #f56c6c;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }
        
        .error-message.show {
            display: block;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 480px) {
            .music-cover {
                width: 150px;
                height: 150px;
            }
            
            .music-title {
                font-size: 18px;
            }
            
            .music-artist {
                font-size: 14px;
            }
            
            .control-buttons {
                gap: 15px;
            }
            
            .control-btn {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            .play-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <img src="photo/logo.png" alt="Logo">
                <div class="logo-text">
                    <div class="logo-main">å¤©é©¬è¡Œç©ºåˆ›æ„ç½‘</div>
                    <div class="logo-sub">TianMa Creative Network</div>
                </div>
            </div>
            <div class="slogan">æ‹¥æŠ±åˆ›æ„ ç‚¹äº®äººç”Ÿ</div>
            <div class="auth-icons">
                <a href="login.html" class="auth-icon">ğŸ”‘</a>
                <a href="register.html" class="auth-icon">ğŸ“±</a>
            </div>
        </div>
    </header>
    
    <nav class="mobile-nav">
        <ul class="nav-list">
            <li class="nav-item"><a href="index.html" class="nav-link">é¦–é¡µ</a></li>
            <li class="nav-item"><a href="about.html" class="nav-link">å…³äºæˆ‘ä»¬</a></li>
            <li class="nav-item"><a href="team-info.html" class="nav-link">å›¢é˜ŸæŸ¥è¯¢</a></li>
            <li class="nav-item"><a href="download-materials.html" class="nav-link">èµ„æ–™ä¸‹è½½</a></li>
            <li class="nav-item"><a href="download-software.html" class="nav-link">è½¯ä»¶ä¸‹è½½</a></li>
            <li class="nav-item"><a href="video.html" class="nav-link">è§†é¢‘åŒº</a></li>
            <li class="nav-item"><a href="music.html" class="nav-link active">éŸ³ä¹åŒº</a></li>
            <li class="nav-item"><a href="online-exam.html" class="nav-link">åœ¨çº¿è€ƒè¯•ä¸­å¿ƒ</a></li>
        </ul>
    </nav>
    
    <div class="container">
        <!-- éŸ³ä¹æœç´¢åŒº -->
        <div class="music-search">
            <h2 class="search-title">æœç´¢ç½‘æ˜“äº‘éŸ³ä¹</h2>
            <form class="search-form" id="searchForm">
                <div class="form-group">
                    <label class="form-label" for="musicUrl">éŸ³ä¹é“¾æ¥æˆ–ID</label>
                    <input type="text" id="musicUrl" class="form-input" placeholder="ä¾‹å¦‚ï¼šhttps://y.music.163.com/m/song?id=475479888" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="quality">é€‰æ‹©éŸ³è´¨</label>
                    <select id="quality" class="form-select" required>
                        <option value="standard">æ ‡å‡†éŸ³è´¨</option>
                        <option value="exhigh">æé«˜å“è´¨</option>
                        <option value="lossless">æ— æŸéŸ³è´¨</option>
                        <option value="hires">Hi-ReséŸ³è´¨</option>
                        <option value="jyeffect">é«˜æ¸…ç¯ç»•å£°</option>
                        <option value="sky">æ²‰æµ¸ç¯ç»•å£°</option>
                        <option value="jymaster">è¶…æ¸…æ¯å¸¦</option>
                    </select>
                </div>
                <button type="submit" class="search-btn">æœç´¢å¹¶æ’­æ”¾</button>
            </form>
        </div>
        
        <!-- åŠ è½½çŠ¶æ€ -->
        <div class="loading" id="loading">
            <div>â³ åŠ è½½ä¸­...</div>
        </div>
        
        <!-- é”™è¯¯ä¿¡æ¯ -->
        <div class="error-message" id="errorMessage"></div>
        
        <!-- éŸ³ä¹æ’­æ”¾å™¨ -->
        <div class="music-player" id="musicPlayer">
            <div class="music-info">
                <img id="musicCover" class="music-cover" src="" alt="éŸ³ä¹å°é¢">
                <h3 id="musicTitle" class="music-title"></h3>
                <p id="musicArtist" class="music-artist"></p>
                <span id="musicLevel" class="music-level"></span>
            </div>
            
            <div class="playback-controls">
                <div class="time-display">
                    <span id="currentTime">00:00</span>
                    <span id="duration">00:00</span>
                </div>
                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar" id="progressBar"></div>
                    <div class="progress-handle"></div>
                </div>
                <div class="control-buttons">
                    <button class="control-btn" id="prevBtn" title="ä¸Šä¸€æ›²">â®ï¸</button>
                    <button class="control-btn play-btn" id="playPauseBtn" title="æ’­æ”¾">â–¶ï¸</button>
                    <button class="control-btn" id="nextBtn" title="ä¸‹ä¸€æ›²">â­ï¸</button>
                    <button class="control-btn" id="downloadBtn" title="ä¸‹è½½éŸ³ä¹">â¬‡ï¸</button>
                </div>
            </div>
            
            <!-- æ­Œè¯æ˜¾ç¤ºåŒºåŸŸ -->
            <div class="lyrics-container">
                <h4 class="lyrics-title">æ­Œè¯</h4>
                <div class="lyrics" id="lyrics"></div>
            </div>
        </div>
    </div>
    
    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
    <button id="backToTop" class="back-to-top" title="å›åˆ°é¡¶éƒ¨">â†‘</button>
    
    <footer>
        <div class="container">
            <p>Â© 2024 å¤©é©¬è¡Œç©ºåˆ›æ„ç½‘. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
            <p><a href="https://tmxkcy.xyz" class="desktop-link" style="color: white; text-decoration: none; font-weight: bold; background-color: #ffc107; padding: 8px 16px; border-radius: 20px; display: inline-block; margin: 10px 0;">ç”µè„‘ç‰ˆ</a></p>
            <div class="disclaimer">
                <h3>å…è´£å£°æ˜</h3>
                <p>æœ¬ç½‘ç«™å°šæœªè¿›è¡ŒICPå¤‡æ¡ˆï¼Œä»…ä¾›å­¦ä¹ å’Œäº¤æµä½¿ç”¨ã€‚ç½‘ç«™å†…å®¹ä»…ä»£è¡¨ä½œè€…ä¸ªäººè§‚ç‚¹ï¼Œä¸ä»£è¡¨ä»»ä½•å®˜æ–¹ç«‹åœºã€‚</p>
                <p>æœ¬ç½‘ç«™æä¾›çš„ä¿¡æ¯ä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®æˆ–å…¶ä»–å»ºè®®ã€‚ä½¿ç”¨æœ¬ç½‘ç«™ä¿¡æ¯æ‰€é€ æˆçš„ä»»ä½•åæœï¼Œæœ¬ç½‘ç«™ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚</p>
                <p>æœ¬ç½‘ç«™å¯èƒ½åŒ…å«å¤–éƒ¨é“¾æ¥ï¼Œå¯¹äºè¿™äº›é“¾æ¥æŒ‡å‘çš„ç½‘ç«™å†…å®¹ï¼Œæœ¬ç½‘ç«™ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚</p>
                <p>å¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»æˆ‘ä»¬åˆ é™¤ç›¸å…³å†…å®¹ã€‚è”ç³»æ–¹å¼ï¼štmxkcytd@foxmail.com</p>
            </div>
        </div>
    </footer>
    
    <script>
        // éŸ³ä¹æ’­æ”¾å™¨ç±»
        class MusicPlayer {
            constructor() {
                // è·å–DOMå…ƒç´ 
                this.searchForm = document.getElementById('searchForm');
                this.musicUrlInput = document.getElementById('musicUrl');
                this.qualitySelect = document.getElementById('quality');
                this.loading = document.getElementById('loading');
                this.errorMessage = document.getElementById('errorMessage');
                this.musicPlayer = document.getElementById('musicPlayer');
                this.musicCover = document.getElementById('musicCover');
                this.musicTitle = document.getElementById('musicTitle');
                this.musicArtist = document.getElementById('musicArtist');
                this.musicLevel = document.getElementById('musicLevel');
                this.currentTime = document.getElementById('currentTime');
                this.duration = document.getElementById('duration');
                this.progressContainer = document.getElementById('progressContainer');
                this.progressBar = document.getElementById('progressBar');
                this.playPauseBtn = document.getElementById('playPauseBtn');
                this.prevBtn = document.getElementById('prevBtn');
                this.nextBtn = document.getElementById('nextBtn');
                this.downloadBtn = document.getElementById('downloadBtn');
                this.lyrics = document.getElementById('lyrics');
                
                // çŠ¶æ€ç®¡ç†
                this.audio = new Audio();
                this.currentMusic = null;
                this.isPlaying = false;
                this.lyricLines = [];
                this.currentLyricIndex = -1;
                
                // åˆå§‹åŒ–
                this.init();
            }
            
            init() {
                // ç›‘å¬è¡¨å•æäº¤
                this.searchForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.searchMusic();
                });
                
                // ç›‘å¬æ’­æ”¾æ§åˆ¶æŒ‰é’®ç‚¹å‡»
                this.playPauseBtn.addEventListener('click', () => this.togglePlay());
                this.prevBtn.addEventListener('click', () => this.playPrevious());
                this.nextBtn.addEventListener('click', () => this.playNext());
                this.downloadBtn.addEventListener('click', () => this.downloadMusic());
                
                // ç›‘å¬è¿›åº¦æ¡ç‚¹å‡»
                this.progressContainer.addEventListener('click', (e) => this.seek(e));
                
                // ç›‘å¬éŸ³é¢‘äº‹ä»¶
                this.audio.addEventListener('timeupdate', () => this.updateProgress());
                this.audio.addEventListener('loadedmetadata', () => this.updateDuration());
                this.audio.addEventListener('ended', () => this.playNext());
                this.audio.addEventListener('error', () => this.showError('éŸ³é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•'));
            }
            
            // ä¸‹è½½éŸ³ä¹
            downloadMusic() {
                if (!this.currentMusic) {
                    this.showError('æ²¡æœ‰å¯ä¸‹è½½çš„éŸ³ä¹');
                    return;
                }
                
                try {
                    const musicUrl = this.currentMusic.url.replace(/`/g, '');
                    const fileName = `${this.currentMusic.name} - ${this.currentMusic.ar_name}.mp3`;
                    
                    // åˆ›å»ºä¸‹è½½é“¾æ¥
                    const downloadLink = document.createElement('a');
                    downloadLink.href = musicUrl;
                    downloadLink.download = fileName;
                    downloadLink.style.display = 'none';
                    
                    // æ·»åŠ åˆ°DOMå¹¶è§¦å‘ä¸‹è½½
                    document.body.appendChild(downloadLink);
                    downloadLink.click();
                    
                    // æ¸…ç†
                    document.body.removeChild(downloadLink);
                    
                    // æ˜¾ç¤ºä¸‹è½½æˆåŠŸä¿¡æ¯
                    this.showSuccess('éŸ³ä¹ä¸‹è½½å·²å¼€å§‹');
                } catch (error) {
                    console.error('ä¸‹è½½å¤±è´¥:', error);
                    this.showError('éŸ³ä¹ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            }
            
            // æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
            showSuccess(message) {
                this.errorMessage.textContent = message;
                this.errorMessage.style.background = '#f0f9eb';
                this.errorMessage.style.color = '#67c23a';
                this.errorMessage.classList.add('show');
                
                // 3ç§’åè‡ªåŠ¨éšè—æˆåŠŸä¿¡æ¯
                setTimeout(() => {
                    this.hideError();
                }, 3000);
            }
            
            // æœç´¢éŸ³ä¹
            async searchMusic() {
                const url = this.musicUrlInput.value.trim();
                const quality = this.qualitySelect.value;
                
                if (!url) {
                    this.showError('è¯·è¾“å…¥éŸ³ä¹é“¾æ¥æˆ–ID');
                    return;
                }
                
                this.showLoading();
                this.hideError();
                
                try {
                    // æ„å»ºAPIè¯·æ±‚URL
                    const apiUrl = `https://api.kxzjoker.cn/api/163_music?url=${encodeURIComponent(url)}&level=${quality}&type=json`;
                    
                    // å‘é€è¯·æ±‚
                    const response = await fetch(apiUrl);
                    if (!response.ok) {
                        throw new Error('APIè¯·æ±‚å¤±è´¥');
                    }
                    
                    const data = await response.json();
                    
                    if (data.status !== 200) {
                        throw new Error(data.message || 'è·å–éŸ³ä¹ä¿¡æ¯å¤±è´¥');
                    }
                    
                    // ä¿å­˜å½“å‰éŸ³ä¹ä¿¡æ¯
                    this.currentMusic = data;
                    
                    // æ›´æ–°UI
                    this.updateMusicInfo(data);
                    
                    // æ’­æ”¾éŸ³ä¹
                    await this.playMusic(data.url);
                    
                    // è§£ææ­Œè¯
                    this.parseLyrics(data.lyric);
                    
                    // æ˜¾ç¤ºæ’­æ”¾å™¨
                    this.musicPlayer.style.display = 'block';
                } catch (error) {
                    this.showError(error.message || 'æœç´¢å¤±è´¥ï¼Œè¯·é‡è¯•');
                } finally {
                    this.hideLoading();
                }
            }
            
            // æ›´æ–°éŸ³ä¹ä¿¡æ¯
            updateMusicInfo(data) {
                this.musicTitle.textContent = data.name;
                this.musicArtist.textContent = data.ar_name;
                this.musicLevel.textContent = data.level;
                this.musicCover.src = data.pic.replace(/`/g, '');
                this.musicCover.alt = data.name;
            }
            
            // æ’­æ”¾éŸ³ä¹
            async playMusic(url) {
                this.audio.src = url.replace(/`/g, '');
                await this.audio.play();
                this.isPlaying = true;
                this.playPauseBtn.textContent = 'â¸ï¸';
                this.playPauseBtn.setAttribute('title', 'æš‚åœ');
            }
            
            // åˆ‡æ¢æ’­æ”¾/æš‚åœ
            togglePlay() {
                if (this.isPlaying) {
                    this.audio.pause();
                    this.isPlaying = false;
                    this.playPauseBtn.textContent = 'â–¶ï¸';
                    this.playPauseBtn.setAttribute('title', 'æ’­æ”¾');
                } else {
                    this.audio.play();
                    this.isPlaying = true;
                    this.playPauseBtn.textContent = 'â¸ï¸';
                    this.playPauseBtn.setAttribute('title', 'æš‚åœ');
                }
            }
            
            // æ’­æ”¾ä¸Šä¸€æ›²ï¼ˆå ä½ï¼Œå¯æ‰©å±•ï¼‰
            playPrevious() {
                this.showError('åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…');
            }
            
            // æ’­æ”¾ä¸‹ä¸€æ›²ï¼ˆå ä½ï¼Œå¯æ‰©å±•ï¼‰
            playNext() {
                this.showError('åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…');
            }
            
            // æ›´æ–°è¿›åº¦
            updateProgress() {
                const currentTime = this.audio.currentTime;
                const duration = this.audio.duration;
                
                if (isNaN(duration)) return;
                
                // æ›´æ–°è¿›åº¦æ¡
                const progressPercent = (currentTime / duration) * 100;
                this.progressBar.style.width = `${progressPercent}%`;
                
                // æ›´æ–°å½“å‰æ—¶é—´
                this.currentTime.textContent = this.formatTime(currentTime);
                
                // æ›´æ–°æ­Œè¯
                this.updateLyrics(currentTime);
            }
            
            // æ›´æ–°æ—¶é•¿
            updateDuration() {
                const duration = this.audio.duration;
                this.duration.textContent = this.formatTime(duration);
            }
            
            // è·³è½¬åˆ°æŒ‡å®šä½ç½®
            seek(e) {
                const rect = this.progressContainer.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const percent = clickX / rect.width;
                const newTime = percent * this.audio.duration;
                this.audio.currentTime = newTime;
            }
            
            // æ ¼å¼åŒ–æ—¶é—´
            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            
            // è§£ææ­Œè¯
            parseLyrics(lyricText) {
                this.lyricLines = [];
                this.currentLyricIndex = -1;
                this.lyrics.innerHTML = '';
                
                if (!lyricText) {
                    this.lyrics.textContent = 'æš‚æ— æ­Œè¯';
                    return;
                }
                
                // è§£ææ­Œè¯è¡Œ
                const lines = lyricText.split('\n');
                const lyricRegex = /\[(\d{2}):(\d{2})\.(\d{2,3})\]\s*(.*)/;
                
                lines.forEach(line => {
                    const match = line.match(lyricRegex);
                    if (match) {
                        const mins = parseInt(match[1]);
                        const secs = parseInt(match[2]);
                        const ms = parseInt(match[3].padEnd(3, '0'));
                        const time = mins * 60 + secs + ms / 1000;
                        const text = match[4].trim();
                        
                        if (text) {
                            this.lyricLines.push({ time, text });
                        }
                    }
                });
                
                // æ¸²æŸ“æ­Œè¯
                this.renderLyrics();
            }
            
            // æ¸²æŸ“æ­Œè¯
            renderLyrics() {
                this.lyrics.innerHTML = '';
                
                this.lyricLines.forEach((line, index) => {
                    const lyricLine = document.createElement('div');
                    lyricLine.className = 'lyric-line';
                    lyricLine.textContent = line.text;
                    lyricLine.dataset.index = index;
                    this.lyrics.appendChild(lyricLine);
                });
            }
            
            // æ›´æ–°æ­Œè¯
            updateLyrics(currentTime) {
                // æ‰¾åˆ°å½“å‰æ—¶é—´å¯¹åº”çš„æ­Œè¯ç´¢å¼•
                let newIndex = -1;
                for (let i = 0; i < this.lyricLines.length; i++) {
                    if (currentTime >= this.lyricLines[i].time) {
                        newIndex = i;
                    } else {
                        break;
                    }
                }
                
                // å¦‚æœç´¢å¼•å˜åŒ–ï¼Œæ›´æ–°æ­Œè¯é«˜äº®
                if (newIndex !== this.currentLyricIndex) {
                    // ç§»é™¤ä¹‹å‰çš„é«˜äº®
                    if (this.currentLyricIndex >= 0 && this.currentLyricIndex < this.lyricLines.length) {
                        const prevLine = this.lyrics.children[this.currentLyricIndex];
                        if (prevLine) {
                            prevLine.classList.remove('active');
                        }
                    }
                    
                    // æ·»åŠ æ–°çš„é«˜äº®
                    if (newIndex >= 0 && newIndex < this.lyricLines.length) {
                        const currentLine = this.lyrics.children[newIndex];
                        if (currentLine) {
                            currentLine.classList.add('active');
                            // æ»šåŠ¨åˆ°å½“å‰æ­Œè¯
                            currentLine.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }
                    
                    this.currentLyricIndex = newIndex;
                }
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoading() {
                this.loading.classList.add('show');
            }
            
            // éšè—åŠ è½½çŠ¶æ€
            hideLoading() {
                this.loading.classList.remove('show');
            }
            
            // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
            showError(message) {
                this.errorMessage.textContent = message;
                this.errorMessage.classList.add('show');
            }
            
            // éšè—é”™è¯¯ä¿¡æ¯
            hideError() {
                this.errorMessage.classList.remove('show');
            }
        }
        
        // åˆå§‹åŒ–éŸ³ä¹æ’­æ”¾å™¨
        document.addEventListener('DOMContentLoaded', () => {
            new MusicPlayer();
        });
        
        // å›åˆ°é¡¶éƒ¨åŠŸèƒ½
        const backToTopBtn = document.getElementById('backToTop');
        
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                backToTopBtn.classList.add('show');
            } else {
                backToTopBtn.classList.remove('show');
            }
        });
        
        backToTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    </script>
</body>
</html>