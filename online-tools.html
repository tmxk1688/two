<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åœ¨çº¿å·¥å…· - å¤©é©¬è¡Œç©ºåˆ›æ„ç½‘</title>
    <link rel="icon" href="photo/logo.png" type="image/png">
    <link rel="stylesheet" href="css/style.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background-color: #f8f9fa; color: #333; line-height: 1.6; }
        .container { 
            width: 100%;
            max-width: 480px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* ç¾åŒ–header */
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo img {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            margin-right: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .logo-text {
            display: flex;
            flex-direction: column;
        }
        
        .logo-main {
            font-size: 18px;
            font-weight: bold;
            color: white;
        }
        
        .logo-sub {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .slogan {
            font-size: 16px;
            color: white;
            font-weight: 600;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .auth-icons {
            display: flex;
            gap: 15px;
        }
        
        .auth-icon {
            font-size: 20px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .auth-icon:hover {
            transform: scale(1.1);
            color: #ffd700;
        }
        
        /* å“åº”å¼è°ƒæ•´header */
        @media (max-width: 480px) {
            .header-content {
                flex-wrap: wrap;
                justify-content: center;
                gap: 15px;
            }
            
            .logo {
                order: 1;
            }
            
            .slogan {
                order: 3;
                width: 100%;
            }
            
            .auth-icons {
                order: 2;
            }
        }
        
        /* ç¾åŒ–å¯¼èˆª */
        .mobile-nav {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .nav-list {
            display: flex;
            overflow-x: auto;
            padding: 0 15px;
            gap: 20px;
            list-style: none;
        }
        
        .nav-item {
            flex-shrink: 0;
        }
        
        .nav-link {
            display: block;
            padding: 15px 0;
            color: #333;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover,
        .nav-link.active {
            color: #667eea;
        }
        
        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 3px;
        }
        
        /* ç¾åŒ–banner */
        .banner {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 40px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .banner::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            animation: float 20s linear infinite;
        }
        
        @keyframes float {
            0% { transform: translate(0, 0); }
            100% { transform: translate(30px, 30px); }
        }
        
        .banner-content {
            position: relative;
            z-index: 1;
        }
        
        .banner h1 {
            font-size: 32px;
            margin-bottom: 15px;
            font-weight: 800;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 0.8s ease-out;
        }
        
        .banner p {
            font-size: 16px;
            margin-bottom: 25px;
            opacity: 0.9;
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }
        
        /* ç¾åŒ–section */
        section {
            margin: 40px 0;
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
            animation: fadeInUp 0.8s ease-out;
        }
        
        .section-title {
            font-size: 22px;
            color: #667eea;
            margin-bottom: 20px;
            font-weight: 700;
            position: relative;
            padding-bottom: 10px;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 3px;
        }
        
        /* Main Content */
        .main-content {
            margin-top: 20px;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-radius: 8px;
            padding: 20px;
        }
        
        /* Tools Section */
        .tools-section {
            margin-bottom: 30px;
        }
        
        .tools-section h2 {
            color: #0066cc;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .tools-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        /* Tools Grid */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        /* Tool Card */
        .tool-card {
            background-color: #fafafa;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .tool-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-color: #ddd;
        }
        
        .tool-card h4 {
            color: #0066cc;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .tool-card p {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
            font-size: 14px;
        }
        
        .tool-link {
            display: inline-block;
            padding: 10px 20px;
            background-color: #0066cc;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .tool-link:hover {
            background-color: #0052a3;
            transform: translateY(-1px);
        }
        
        /* Tool Category */
        .tool-category {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        /* Search Section */
        .search-section {
            background-color: #f0f0f0;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .search-section h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .search-section form {
            display: flex;
            gap: 10px;
        }
        
        .search-section input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .search-section button {
            padding: 12px 24px;
            background-color: #0066cc;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .search-section button:hover {
            background-color: #0052a3;
        }
        
        /* Tool Tags */
        .tool-tags {
            margin: 10px 0;
        }
        
        .tool-tag {
            display: inline-block;
            padding: 4px 10px;
            background-color: #e0e0e0;
            color: #666;
            border-radius: 12px;
            font-size: 12px;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        
        /* å›åˆ°é¡¶éƒ¨æŒ‰é’® */
        .back-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 999;
        }
        
        .back-to-top.show {
            opacity: 1;
            visibility: visible;
        }
        
        .back-to-top:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ç¾åŒ–footer */
        footer {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px 0;
            text-align: center;
        }
        
        footer p {
            margin-bottom: 15px;
            opacity: 0.9;
        }
        
        .disclaimer {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .disclaimer h3 {
            font-size: 16px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .disclaimer p {
            font-size: 12px;
            margin-bottom: 8px;
            opacity: 0.8;
        }
    </style>
    <!-- æ–°å¹´ä¸»é¢˜æ ·å¼ -->
    <link rel="stylesheet" href="css/newyear.css">
    <style>
        /* æƒé™ç éªŒè¯å¼¹çª—æ ·å¼ */
        .permission-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .permission-modal.show {
            display: flex;
        }
        
        .permission-modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px;
        }
        
        .permission-modal-content h3 {
            color: #0066cc;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .permission-modal-content p {
            margin-bottom: 20px;
            text-align: center;
            color: #666;
        }
        
        .permission-input-group {
            margin-bottom: 20px;
        }
        
        .permission-input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }
        
        .permission-input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .permission-modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .permission-modal-buttons button {
            padding: 10px 25px;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .permission-modal-buttons .btn-primary {
            background-color: #0066cc;
            color: white;
        }
        
        .permission-modal-buttons .btn-primary:hover {
            background-color: #0052a3;
        }
        
        .permission-modal-buttons .btn-cancel {
            background-color: #f0f0f0;
            color: #333;
        }
        
        .permission-modal-buttons .btn-cancel:hover {
            background-color: #e0e0e0;
        }
        
        /* å·¥å…·é“¾æ¥æ ·å¼è°ƒæ•´ */
        .tool-link {
            cursor: pointer;
        }
        
        /* AIèŠå¤©å¼¹çª—æ ·å¼ - è±†åŒ…é£æ ¼ */
        .chat-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: flex-end;
            z-index: 2000;
        }
        
        .chat-modal.show {
            display: flex;
        }
        
        .chat-modal-content {
            background-color: #f7f8fa;
            border-radius: 16px 16px 0 0;
            width: 100%;
            max-width: 480px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* èŠå¤©å¤´éƒ¨æ ·å¼ - è±†åŒ…é£æ ¼ */
        .chat-header {
            background: white;
            color: #333;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }
        
        .chat-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* æœºå™¨äººå¤´åƒ */
        .bot-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .chat-close-btn {
            background: #f0f0f0;
            border: none;
            color: #666;
            font-size: 18px;
            cursor: pointer;
            padding: 6px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .chat-close-btn:hover {
            background-color: #e0e0e0;
        }
        
        /* èŠå¤©æ¶ˆæ¯åŒºåŸŸæ ·å¼ - è±†åŒ…é£æ ¼ */
        .chat-messages {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            background-color: #f7f8fa;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        /* èŠå¤©æ¶ˆæ¯æ ·å¼ - è±†åŒ…é£æ ¼ */
        .chat-message {
            display: flex;
            align-items: flex-start;
            animation: fadeInUp 0.3s ease-out;
            gap: 10px;
        }
        
        .chat-message.user-message {
            justify-content: flex-end;
        }
        
        .chat-message.bot-message {
            justify-content: flex-start;
        }
        
        /* æ¶ˆæ¯å¤´åƒ */
        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
            margin-top: 4px;
        }
        
        .bot-message .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .user-message .message-avatar {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
            line-height: 1.5;
            position: relative;
        }
        
        .user-message .message-content {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .bot-message .message-content {
            background-color: white;
            color: #333;
            border: 1px solid #e5e6eb;
            border-bottom-left-radius: 4px;
        }
        
        .message-content p {
            margin: 0;
        }
        
        /* èŠå¤©è¾“å…¥åŒºåŸŸæ ·å¼ - è±†åŒ…é£æ ¼ */
        .chat-input-area {
            display: flex;
            flex-direction: column;
            padding: 12px 16px;
            background-color: white;
            border-top: 1px solid #e5e6eb;
            gap: 8px;
        }
        
        /* èŠå¤©å·¥å…·æ æ ·å¼ - è±†åŒ…é£æ ¼ */
        .chat-input-toolbar {
            display: flex;
            gap: 16px;
            padding: 8px;
            background-color: #f7f8fa;
            border-radius: 24px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .chat-tool-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 8px 0;
            border-radius: 8px;
            transition: all 0.3s ease;
            color: #666;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            min-width: 56px;
        }
        
        .tool-btn-icon {
            font-size: 22px;
            display: block;
        }
        
        .tool-btn-label {
            font-size: 12px;
            font-weight: 500;
            display: block;
        }
        
        .chat-tool-btn:hover {
            background-color: rgba(79, 172, 254, 0.1);
            color: #4facfe;
        }
        
        /* èŠå¤©è¾“å…¥ä¸»ä½“æ ·å¼ - è±†åŒ…é£æ ¼ */
        .chat-input-main {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }
        
        #chatInput {
            flex: 1;
            padding: 10px 16px;
            border: 1px solid #e5e6eb;
            border-radius: 20px;
            font-size: 15px;
            outline: none;
            transition: all 0.3s ease;
            background-color: #f7f8fa;
            min-height: 40px;
            max-height: 100px;
            overflow-y: auto;
            resize: none;
        }
        
        #chatInput:focus {
            border-color: #4facfe;
            background-color: white;
            box-shadow: 0 0 0 2px rgba(79, 172, 254, 0.1);
        }
        
        .chat-send-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(79, 172, 254, 0.3);
            flex-shrink: 0;
        }
        
        .chat-send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(79, 172, 254, 0.4);
        }
        
        /* å›¾ç‰‡ç”Ÿæˆé€‰é¡¹æ ·å¼ - è±†åŒ…é£æ ¼ */
        .image-generation-options {
            background-color: white;
            padding: 16px;
            border-top: 1px solid #e5e6eb;
        }
        
        .image-generation-options h4 {
            margin: 0 0 12px 0;
            color: #333;
            font-size: 15px;
            font-weight: 600;
        }
        
        .image-option-group {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .image-option-group label {
            font-size: 14px;
            color: #666;
            font-weight: 500;
            min-width: 40px;
        }
        
        .image-option-group select {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #e5e6eb;
            border-radius: 8px;
            font-size: 14px;
            background-color: white;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .image-option-group select:focus {
            border-color: #4facfe;
            box-shadow: 0 0 0 2px rgba(79, 172, 254, 0.1);
        }
        
        .image-option-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 16px;
        }
        
        .image-generate-btn,
        .image-cancel-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .image-generate-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .image-generate-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(79, 172, 254, 0.4);
        }
        
        .image-cancel-btn {
            background-color: #f7f8fa;
            color: #666;
            border: 1px solid #e5e6eb;
        }
        
        .image-cancel-btn:hover {
            background-color: #eef1f5;
            transform: translateY(-1px);
        }
        
        /* å›¾ç‰‡æ¶ˆæ¯æ ·å¼ - è±†åŒ…é£æ ¼ */
        .chat-message img {
            max-width: 80%;
            border-radius: 12px;
            margin: 8px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .chat-message img:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ - è±†åŒ…é£æ ¼ */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* æ¶ˆæ¯åŠ è½½çŠ¶æ€ - è±†åŒ…é£æ ¼ */
        .message-loading {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
        }
        
        .loading-dot {
            width: 8px;
            height: 8px;
            background-color: #999;
            border-radius: 50%;
            animation: loadingBounce 1.4s infinite ease-in-out both;
        }
        
        .loading-dot:nth-child(1) {
            animation-delay: -0.32s;
        }
        
        .loading-dot:nth-child(2) {
            animation-delay: -0.16s;
        }
        
        @keyframes loadingBounce {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1.0);
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <img src="photo/logo.png" alt="Logo">
                <div class="logo-text">
                    <div class="logo-main">å¤©é©¬è¡Œç©ºåˆ›æ„ç½‘</div>
                    <div class="logo-sub">TianMa Creative Network</div>
                </div>
            </div>
            <div class="slogan">æ‹¥æŠ±åˆ›æ„ ç‚¹äº®äººç”Ÿ</div>
            <div class="auth-icons">
                <a href="login.html" class="auth-icon">ğŸ”</a>
                <a href="register.html" class="auth-icon">ğŸ“±</a>
            </div>
        </div>
    </header>
    
    <nav class="mobile-nav">
        <ul class="nav-list">
            <li class="nav-item"><a href="index.html" class="nav-link">é¦–é¡µ</a></li>
            <li class="nav-item"><a href="about.html" class="nav-link">å…³äºæˆ‘ä»¬</a></li>
            <li class="nav-item"><a href="news.html" class="nav-link">æ–°é—»åŠ¨æ€</a></li>
            <li class="nav-item"><a href="team-info.html" class="nav-link">å›¢é˜ŸæŸ¥è¯¢</a></li>
            <li class="nav-item"><a href="download-materials.html" class="nav-link">èµ„æ–™ä¸‹è½½</a></li>
            <li class="nav-item"><a href="download-software.html" class="nav-link">è½¯ä»¶ä¸‹è½½</a></li>
            <li class="nav-item"><a href="video.html" class="nav-link">è§†é¢‘åŒº</a></li>
            <li class="nav-item"><a href="music.html" class="nav-link">éŸ³ä¹åŒº</a></li>
        </ul>
    </nav>
    
    <div class="banner">
        <div class="container banner-content">
            <h1>åœ¨çº¿å·¥å…·</h1>
            <p>è®¿é—®å„ç§å®ç”¨åœ¨çº¿å·¥å…·ï¼ŒåŒ…å«å½•åˆ¶ã€è®¾è®¡ã€AIç­‰å·¥å…·</p>
        </div>
    </div>
    
    <div class="container main-content">
        <!-- å·¥å…·æœç´¢ -->
        <div class="search-section">
            <h3>æœç´¢å·¥å…·</h3>
            <form onsubmit="searchTools(event)">
                <input type="text" id="searchInput" placeholder="è¾“å…¥å·¥å…·åç§°æˆ–å…³é”®è¯æœç´¢...">
                <button type="submit">æœç´¢</button>
            </form>
        </div>
        
        <!-- æ‰€æœ‰å·¥å…· -->
        <div class="tools-section">
            <h2>å®ç”¨å·¥å…·é›†åˆ</h2>
            
            <!-- AIå·¥å…· -->
            <div class="tool-category">
                <h3>ğŸ” AIå·¥å…·</h3>
                <div class="tools-grid">
                    <!-- VGO.PUB -->
                    <div class="tool-card" data-tool-name="VGO.PUB" data-tool-tags="AI,è§†é¢‘,å¤„ç†">
                        <h4>VGO.PUB</h4>
                        <div class="tool-tags">
                            <span class="tool-tag">AI</span>
                            <span class="tool-tag">è§†é¢‘</span>
                            <span class="tool-tag">å¤„ç†</span>
                        </div>
                        <p>ä¸€æ¬¾å¼ºå¤§çš„AIè§†é¢‘å¤„ç†å·¥å…·ï¼Œæ”¯æŒè§†é¢‘ç¼–è¾‘ã€è½¬ç ã€å‹ç¼©ç­‰åŠŸèƒ½ã€‚</p>
                        <a href="https://vgo.pub/" class="tool-link" target="_blank">è®¿é—®å·¥å…·</a>
                    </div>
                    
                    <!-- FOGSIGHT.AI -->
                    <div class="tool-card" data-tool-name="Fogsight AI" data-tool-tags="AI,åˆ†æ,æ™ºèƒ½">
                        <h4>Fogsight AI</h4>
                        <div class="tool-tags">
                            <span class="tool-tag">AI</span>
                            <span class="tool-tag">åˆ†æ</span>
                            <span class="tool-tag">æ™ºèƒ½</span>
                        </div>
                        <p>æ™ºèƒ½AIåˆ†æå·¥å…·ï¼Œæä¾›å›¾åƒè¯†åˆ«ã€æ•°æ®åˆ†æç­‰åŠŸèƒ½ã€‚</p>
                        <a href="https://fogsight.ai/" class="tool-link" target="_blank">è®¿é—®å·¥å…·</a>
                    </div>
                    
                    <!-- å¤©é©¬è¡Œç©ºåˆ›æ„å°åŠ©æ‰‹ -->
                    <div class="tool-card" data-tool-name="å¤©é©¬è¡Œç©ºåˆ›æ„å°åŠ©æ‰‹" data-tool-tags="AI,èŠå¤©,æ™ºèƒ½">
                        <h4>å¤©é©¬è¡Œç©ºåˆ›æ„å°åŠ©æ‰‹</h4>
                        <div class="tool-tags">
                            <span class="tool-tag">AI</span>
                            <span class="tool-tag">èŠå¤©</span>
                            <span class="tool-tag">æ™ºèƒ½</span>
                        </div>
                        <p>åŸºäºå…ˆè¿›AIæŠ€æœ¯çš„æ™ºèƒ½èŠå¤©å·¥å…·ï¼Œæä¾›å®æ—¶å¯¹è¯ã€é—®ç­”ç­‰åŠŸèƒ½ã€‚</p>
                        <button class="tool-link" onclick="openChatModal()">æ‰“å¼€èŠå¤©</button>
                    </div>
                    
                    <!-- è¯­éŸ³è½¬æ–‡æœ¬ -->
                    <div class="tool-card" data-tool-name="è¯­éŸ³è½¬æ–‡æœ¬" data-tool-tags="AI,è¯­éŸ³,è½¬æ–‡æœ¬">
                        <h4>è¯­éŸ³è½¬æ–‡æœ¬</h4>
                        <div class="tool-tags">
                            <span class="tool-tag">AI</span>
                            <span class="tool-tag">è¯­éŸ³</span>
                            <span class="tool-tag">è½¬æ–‡æœ¬</span>
                        </div>
                        <p>ä½¿ç”¨GLM-ASR-2512æ¨¡å‹å°†éŸ³é¢‘æ–‡ä»¶è½¬å½•ä¸ºæ–‡æœ¬ï¼Œæ”¯æŒå¤šè¯­è¨€å’Œå®æ—¶æµå¼è½¬å½•ã€‚</p>
                        <button class="tool-link" onclick="openSpeechToTextModal()">å¼€å§‹è½¬æ¢</button>
                    </div>
                </div>
            </div>
            
            <!-- è®¾è®¡å·¥å…· -->
            <div class="tool-category">
                <h3>ğŸ¨ è®¾è®¡å·¥å…·</h3>
                <div class="tools-grid">
                    <!-- FONT.ITTOOLS.CC -->
                    <div class="tool-card" data-tool-name="å­—ä½“å·¥å…·" data-tool-tags="å­—ä½“,è®¾è®¡,å·¥å…·">
                        <h4>å­—ä½“å·¥å…·</h4>
                        <div class="tool-tags">
                            <span class="tool-tag">å­—ä½“</span>
                            <span class="tool-tag">è®¾è®¡</span>
                            <span class="tool-tag">å·¥å…·</span>
                        </div>
                        <p>æä¾›å­—ä½“ä¸‹è½½ã€å­—ä½“é¢„è§ˆã€å­—ä½“è½¬æ¢ç­‰å­—ä½“ç›¸å…³å·¥å…·ã€‚</p>
                        <a href="https://font.ittools.cc/" class="tool-link" target="_blank">è®¿é—®å·¥å…·</a>
                    </div>
                </div>
            </div>
            
            <!-- åª’ä½“å·¥å…· -->
            <div class="tool-category">
                <h3>ğŸ¬ åª’ä½“å·¥å…·</h3>
                <div class="tools-grid">
                    <!-- TOOLWA.COM/RECORD -->
                    <div class="tool-card" data-tool-name="åœ¨çº¿å½•å±" data-tool-tags="å½•å±,è§†é¢‘,å½•åˆ¶">
                        <h4>åœ¨çº¿å½•å±</h4>
                        <div class="tool-tags">
                            <span class="tool-tag">å½•å±</span>
                            <span class="tool-tag">è§†é¢‘</span>
                            <span class="tool-tag">å½•åˆ¶</span>
                        </div>
                        <p>å…è´¹åœ¨çº¿å½•å±å·¥å…·ï¼Œæ”¯æŒå±å¹•å½•åˆ¶ã€æ‘„åƒå¤´å½•åˆ¶ç­‰åŠŸèƒ½ã€‚</p>
                        <a href="https://toolwa.com/record/" class="tool-link" target="_blank">è®¿é—®å·¥å…·</a>
                    </div>
                </div>
            </div>
            
            <!-- å®ç”¨å·¥å…· -->
            <div class="tool-category">
                <h3>ğŸ”§ å®ç”¨å·¥å…·</h3>
                <div class="tools-grid">
                    <!-- YEAH6.COM -->
                    <div class="tool-card" data-tool-name="Yeah6å·¥å…·é›†" data-tool-tags="å·¥å…·é›†,å®ç”¨,åœ¨çº¿">
                        <h4>Yeah6å·¥å…·é›†</h4>
                        <div class="tool-tags">
                            <span class="tool-tag">å·¥å…·é›†</span>
                            <span class="tool-tag">å®ç”¨</span>
                            <span class="tool-tag">åœ¨çº¿</span>
                        </div>
                        <p>é›†åˆå¤šç§å®ç”¨åœ¨çº¿å·¥å…·ï¼ŒåŒ…æ‹¬è½¬æ¢ã€è®¡ç®—ã€æŸ¥è¯¢ç­‰åŠŸèƒ½ã€‚</p>
                        <a href="https://www.yeah6.com/" class="tool-link" target="_blank">è®¿é—®å·¥å…·</a>
                    </div>
                    
                    <!-- PAYWALLBUSTER.COM -->
                    <div class="tool-card" data-tool-name="Paywall Buster" data-tool-tags="ä»˜è´¹å¢™,ç»•è¿‡,é˜…è¯»">
                        <h4>Paywall Buster</h4>
                        <div class="tool-tags">
                            <span class="tool-tag">ä»˜è´¹å¢™</span>
                            <span class="tool-tag">ç»•è¿‡</span>
                            <span class="tool-tag">é˜…è¯»</span>
                        </div>
                        <p>å¸®åŠ©ç»•è¿‡ä»˜è´¹å¢™ï¼Œå…è´¹é˜…è¯»ä»˜è´¹æ–‡ç« çš„å·¥å…·ã€‚</p>
                        <a href="https://paywallbuster.com/" class="tool-link" target="_blank">è®¿é—®å·¥å…·</a>
                    </div>
                    
                    <!-- E123.TOP -->
                    <div class="tool-card" data-tool-name="E123å·¥å…·" data-tool-tags="å·¥å…·,åœ¨çº¿,å®ç”¨">
                        <h4>E123å·¥å…·</h4>
                        <div class="tool-tags">
                            <span class="tool-tag">å·¥å…·</span>
                            <span class="tool-tag">åœ¨çº¿</span>
                            <span class="tool-tag">å®ç”¨</span>
                        </div>
                        <p>æä¾›å¤šç§åœ¨çº¿å®ç”¨å·¥å…·ï¼ŒåŒ…æ‹¬æŸ¥è¯¢ã€è½¬æ¢ã€ç”Ÿæˆç­‰åŠŸèƒ½ã€‚</p>
                        <a href="https://e123.top/" class="tool-link" target="_blank">è®¿é—®å·¥å…·</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
    <button id="backToTop" class="back-to-top" title="å›åˆ°é¡¶éƒ¨">â†‘</button>
    
    <footer>
        <div class="container">
            <p>Â© 2024 å¤©é©¬è¡Œç©ºåˆ›æ„ç½‘. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
            <p><a href="https://tmxkcy.xyz" class="desktop-link" style="color: white; text-decoration: none; font-weight: bold; background-color: #ffc107; padding: 8px 16px; border-radius: 20px; display: inline-block; margin: 10px 0;">ç”µè„‘ç‰ˆ</a></p>
            <div class="disclaimer">
                <h3>å…è´£å£°æ˜</h3>
                <p>æœ¬ç½‘ç«™å°šæœªè¿›è¡ŒICPå¤‡æ¡ˆï¼Œä»…ä¾›å­¦ä¹ å’Œäº¤æµä½¿ç”¨ã€‚ç½‘ç«™å†…å®¹ä»…ä»£è¡¨ä½œè€…ä¸ªäººè§‚ç‚¹ï¼Œä¸ä»£è¡¨ä»»ä½•å®˜æ–¹ç«‹åœºã€‚</p>
                <p>æœ¬ç½‘ç«™æä¾›çš„ä¿¡æ¯ä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®æˆ–å…¶ä»–å»ºè®®ã€‚ä½¿ç”¨æœ¬ç½‘ç«™ä¿¡æ¯æ‰€é€ æˆçš„ä»»ä½•åæœï¼Œæœ¬ç½‘ç«™ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚</p>
                <p>æœ¬ç½‘ç«™å¯èƒ½åŒ…å«å¤–éƒ¨é“¾æ¥ï¼Œå¯¹äºè¿™äº›é“¾æ¥æŒ‡å‘çš„ç½‘ç«™å†…å®¹ï¼Œæœ¬ç½‘ç«™ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚</p>
                <p>å¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»æˆ‘ä»¬åˆ é™¤ç›¸å…³å†…å®¹ã€‚è”ç³»æ–¹å¼ï¼štmxkcytd@foxmail.com</p>
            </div>
        </div>
    </footer>
    
    <script>
        // å›åˆ°é¡¶éƒ¨æŒ‰é’®åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            const backToTopBtn = document.getElementById('backToTop');
            
            // æ»šåŠ¨äº‹ä»¶ç›‘å¬
            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 300) {
                    backToTopBtn.classList.add('show');
                } else {
                    backToTopBtn.classList.remove('show');
                }
            });
            
            // ç‚¹å‡»å›åˆ°é¡¶éƒ¨
            backToTopBtn.addEventListener('click', function() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        });
        // å·¥å…·æœç´¢åŠŸèƒ½
        function searchTools(event) {
            event.preventDefault();
            const searchInput = document.getElementById('searchInput');
            const searchTerm = searchInput.value.toLowerCase().trim();
            const toolCards = document.querySelectorAll('.tool-card');
            
            if (!searchTerm) {
                // å¦‚æœæœç´¢ä¸ºç©ºï¼Œæ˜¾ç¤ºæ‰€æœ‰å·¥å…·
                toolCards.forEach(card => {
                    card.style.display = 'block';
                });
                return;
            }
            
            // æœç´¢å·¥å…·
            toolCards.forEach(card => {
                const toolName = card.dataset.toolName.toLowerCase();
                const toolTags = card.dataset.toolTags.toLowerCase();
                
                if (toolName.includes(searchTerm) || toolTags.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // æ·»åŠ å›è½¦é”®æœç´¢æ”¯æŒ
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchTools(e);
            }
        });
        

        
        // æŒ‰ä¸‹ESCé”®å…³é—­å¼¹çª—
        window.addEventListener('keydown', function(event) {
            const permissionModal = document.getElementById('permissionModal');
            const chatModal = document.getElementById('chatModal');
            
            if (event.key === 'Escape') {
                if (permissionModal.classList.contains('show')) {
                    closePermissionModal();
                } else if (chatModal.classList.contains('show')) {
                    closeChatModal();
                }
            }
        });
        
        // AIèŠå¤©åŠŸèƒ½
        // APIé…ç½®
        const API_CONFIG = {
            name: 'glm-4.6v',
            key: 'b662eeada77a4b7a9e44c00317d9fdc4.yUYvYP5grCYjhEIm',
            endpoint: 'https://open.bigmodel.cn/api/paas/v4/chat/completions'
        };
        
        // èŠå¤©æ¶ˆæ¯å†å²
        let chatHistory = [];
        
        // æ‰“å¼€èŠå¤©å¼¹çª—
        function openChatModal() {
            document.getElementById('chatModal').classList.add('show');
            // èšç„¦åˆ°è¾“å…¥æ¡†
            document.getElementById('chatInput').focus();
        }
        
        // å…³é—­èŠå¤©å¼¹çª—
        function closeChatModal() {
            document.getElementById('chatModal').classList.remove('show');
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('chatInput').value = '';
        }
        
        // å‘é€æ¶ˆæ¯
        async function sendMessage() {
            const chatInput = document.getElementById('chatInput');
            const message = chatInput.value.trim();
            
            if (!message) {
                return;
            }
            
            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°èŠå¤©è®°å½•
            addMessageToChat(message, 'user');
            chatInput.value = '';
            
            // æ·»åŠ åˆ°å†å²è®°å½•
            chatHistory.push({
                role: 'user',
                content: message
            });
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoadingState();
            
            try {
                // è°ƒç”¨APIè·å–å›å¤
                const response = await callChatAPI(message);
                
                // éšè—åŠ è½½çŠ¶æ€
                hideLoadingState();
                
                // æ·»åŠ AIå›å¤åˆ°èŠå¤©è®°å½•
                addMessageToChat(response, 'bot');
                
                // æ·»åŠ åˆ°å†å²è®°å½•
                chatHistory.push({
                    role: 'assistant',
                    content: response
                });
            } catch (error) {
                // éšè—åŠ è½½çŠ¶æ€
                hideLoadingState();
                
                // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                addMessageToChat('æŠ±æ­‰ï¼Œæˆ‘æš‚æ—¶æ— æ³•å›ç­”ä½ çš„é—®é¢˜ï¼Œè¯·ç¨åå†è¯•ã€‚', 'bot');
                console.error('AIèŠå¤©APIè°ƒç”¨å¤±è´¥:', error);
            }
        }
        
        // è°ƒç”¨èŠå¤©API
        async function callChatAPI(message) {
            // æ„å»ºAPIè¯·æ±‚ä½“
            const requestBody = {
                model: API_CONFIG.name,
                messages: [...chatHistory, {
                    role: 'user',
                    content: [{
                        type: 'text',
                        text: message
                    }]
                }],
                thinking: {
                    type: 'enabled'
                },
                stream: true
            };
            
            // è°ƒç”¨çœŸå®API
            const response = await fetch(API_CONFIG.endpoint, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_CONFIG.key}`
                },
                body: JSON.stringify(requestBody)
            });
            
            if (!response.ok) {
                throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
            }
            
            // å¤„ç†æµå¼å“åº”
            return new Promise((resolve, reject) => {
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let fullResponse = '';
                let thinkingContent = '';
                let isThinkingActive = false;
                let thinkingMessageElement = null;
                
                function createThinkingMessage() {
                    if (!thinkingMessageElement) {
                        const chatMessages = document.getElementById('chatMessages');
                        const thinkingDiv = document.createElement('div');
                        thinkingDiv.className = 'chat-message bot-message';
                        thinkingDiv.id = 'thinkingMessage';
                        
                        const avatar = document.createElement('div');
                        avatar.className = 'message-avatar';
                        avatar.textContent = 'ğŸ¤–';
                        
                        const messageContent = document.createElement('div');
                        messageContent.className = 'message-content';
                        messageContent.innerHTML = '<strong>æ€è€ƒä¸­...</strong><div class="thinking-content"></div>';
                        
                        thinkingDiv.appendChild(avatar);
                        thinkingDiv.appendChild(messageContent);
                        chatMessages.appendChild(thinkingDiv);
                        thinkingMessageElement = thinkingDiv;
                        scrollToBottom();
                    }
                }
                
                function updateThinkingContent(content) {
                    if (thinkingMessageElement) {
                        const thinkingContentElement = thinkingMessageElement.querySelector('.thinking-content');
                        if (thinkingContentElement) {
                            // ç›´æ¥è®¾ç½®innerHTMLï¼Œå…è®¸æ˜¾ç¤ºdivç­‰HTMLå…ƒç´ 
                            thinkingContentElement.innerHTML = content;
                            scrollToBottom();
                        }
                    }
                }
                
                function removeThinkingMessage() {
                    if (thinkingMessageElement) {
                        thinkingMessageElement.remove();
                        thinkingMessageElement = null;
                    }
                }
                
                function processChunk(chunk) {
                    const lines = chunk.split('\n');
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const dataStr = line.slice(6);
                            if (dataStr === '[DONE]') {
                                removeThinkingMessage();
                                resolve(fullResponse);
                                return;
                            }
                            
                            try {
                                const data = JSON.parse(dataStr);
                                
                                // å¤„ç†æ€è€ƒè¿‡ç¨‹
                                if (data.choices && data.choices[0].thinking) {
                                    isThinkingActive = true;
                                    createThinkingMessage();
                                    thinkingContent = data.choices[0].thinking;
                                    updateThinkingContent(thinkingContent);
                                }
                                
                                // å¤„ç†æœ€ç»ˆå“åº”
                                if (data.choices && data.choices[0].message && data.choices[0].message.content) {
                                    fullResponse = data.choices[0].message.content;
                                }
                            } catch (error) {
                                console.error('è§£ææµå¼æ•°æ®å¤±è´¥:', error);
                            }
                        }
                    }
                }
                
                function readStream() {
                    reader.read().then(({ done, value }) => {
                        if (done) {
                            removeThinkingMessage();
                            resolve(fullResponse);
                            return;
                        }
                        
                        const chunk = decoder.decode(value, { stream: true });
                        processChunk(chunk);
                        readStream();
                    }).catch(error => {
                        removeThinkingMessage();
                        reject(error);
                    });
                }
                
                readStream();
            });
        }
        
        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©ç•Œé¢
        function addMessageToChat(message, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}-message`;
            
            // åˆ›å»ºå¤´åƒ
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = sender === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            
            // ç›´æ¥è®¾ç½®innerHTMLä»¥æ”¯æŒHTMLæ ‡ç­¾ï¼ŒåŒ…æ‹¬divå…ƒç´ 
            messageContent.innerHTML = message;
            
            // æ ¹æ®å‘é€è€…æ·»åŠ å¤´åƒåˆ°æ¶ˆæ¯
            if (sender === 'bot') {
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(messageContent);
            } else {
                messageDiv.appendChild(messageContent);
                messageDiv.appendChild(avatar);
            }
            
            chatMessages.appendChild(messageDiv);
            
            // æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
            scrollToBottom();
        }
        
        // æ»šåŠ¨åˆ°èŠå¤©åº•éƒ¨
        function scrollToBottom() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoadingState() {
            const chatMessages = document.getElementById('chatMessages');
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'chat-message bot-message';
            loadingDiv.id = 'loadingMessage';
            
            const loadingContent = document.createElement('div');
            loadingContent.className = 'message-content';
            
            const loadingIndicator = document.createElement('div');
            loadingIndicator.className = 'message-loading';
            loadingIndicator.innerHTML = `
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
            `;
            
            loadingContent.appendChild(loadingIndicator);
            loadingDiv.appendChild(loadingContent);
            chatMessages.appendChild(loadingDiv);
            
            // æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
            scrollToBottom();
        }
        
        // éšè—åŠ è½½çŠ¶æ€
        function hideLoadingState() {
            const loadingMessage = document.getElementById('loadingMessage');
            if (loadingMessage) {
                loadingMessage.remove();
            }
        }
        
        // ç›‘å¬èŠå¤©è¾“å…¥æ¡†çš„å›è½¦é”®å‘é€
        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }
        });
        
        // å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
        function triggerImageUpload() {
            document.getElementById('imageUpload').click();
        }
        
        async function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }
            
            // æ£€æŸ¥æ–‡ä»¶ç±»å‹
            if (!file.type.startsWith('image/')) {
                alert('è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼');
                return;
            }
            
            // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶ä¸º5MBï¼Œç¬¦åˆæ™ºè°±AI APIè¦æ±‚ï¼‰
            if (file.size > 5 * 1024 * 1024) {
                alert('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MBï¼');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            addMessageToChat('æ­£åœ¨ä¸Šä¼ å›¾ç‰‡ï¼Œè¯·ç¨å€™...', 'bot');
            
            try {
                // è°ƒç”¨æ™ºè°±AIæ–‡ä»¶ä¸Šä¼ API
                const formData = new FormData();
                formData.append('file', file);
                formData.append('purpose', 'agent'); // ç”¨äºæ™ºèƒ½ä½“æ–‡ä»¶ä¸Šä¼ 
                
                const uploadResponse = await fetch('https://open.bigmodel.cn/api/paas/v4/files', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_CONFIG.key}`
                    },
                    body: formData
                });
                
                if (!uploadResponse.ok) {
                    throw new Error(`æ–‡ä»¶ä¸Šä¼ å¤±è´¥: ${uploadResponse.status}`);
                }
                
                const uploadData = await uploadResponse.json();
                
                // è·å–æ–‡ä»¶ID
                if (uploadData.id) {
                    const fileId = uploadData.id;
                    
                    // æ˜¾ç¤ºå›¾ç‰‡é¢„è§ˆ
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        // æ·»åŠ å›¾ç‰‡åˆ°èŠå¤©è®°å½•
                        addImageToChat(e.target.result, 'user');
                        
                        // è°ƒç”¨AIåˆ†æå›¾ç‰‡
                        analyzeImage(fileId, e.target.result);
                    };
                    reader.readAsDataURL(file);
                } else {
                    throw new Error('æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œä½†æœªè¿”å›æ–‡ä»¶ID');
                }
            } catch (error) {
                console.error('å›¾ç‰‡ä¸Šä¼ å¤±è´¥:', error);
                addMessageToChat('æŠ±æ­‰ï¼Œå›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚\né”™è¯¯ä¿¡æ¯ï¼š' + error.message, 'bot');
            } finally {
                // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
                event.target.value = '';
            }
        }
        
        // è°ƒç”¨AIåˆ†æå›¾ç‰‡
        async function analyzeImage(fileId, imageUrl) {
            try {
                // è°ƒç”¨æ™ºè°±AIèŠå¤©APIåˆ†æå›¾ç‰‡
                const chatResponse = await fetch(API_CONFIG.endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_CONFIG.key}`
                    },
                    body: JSON.stringify({
                        model: API_CONFIG.name,
                        messages: [...chatHistory, {
                            role: 'user',
                            content: [
                                {
                                    type: 'image_url',
                                    image_url: {
                                        url: imageUrl
                                    }
                                },
                                {
                                    type: 'text',
                                    text: 'è¯·åˆ†æè¿™å¼ å›¾ç‰‡çš„å†…å®¹'
                                }
                            ]
                        }],
                        thinking: {
                            type: 'enabled'
                        }
                    })
                });
                
                if (!chatResponse.ok) {
                    throw new Error(`å›¾ç‰‡åˆ†æå¤±è´¥: ${chatResponse.status}`);
                }
                
                const chatData = await chatResponse.json();
                
                // è·å–AIå›å¤
                if (chatData.choices && chatData.choices.length > 0 && chatData.choices[0].message && chatData.choices[0].message.content) {
                    const aiResponse = chatData.choices[0].message.content;
                    addMessageToChat(aiResponse, 'bot');
                } else {
                    throw new Error('å›¾ç‰‡åˆ†ææˆåŠŸï¼Œä½†æœªè¿”å›æœ‰æ•ˆå›å¤');
                }
            } catch (error) {
                console.error('å›¾ç‰‡åˆ†æå¤±è´¥:', error);
                addMessageToChat('æŠ±æ­‰ï¼Œå›¾ç‰‡åˆ†æå¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚\né”™è¯¯ä¿¡æ¯ï¼š' + error.message, 'bot');
            }
        }
        
        function addImageToChat(imageUrl, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}-message`;
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            
            const imageElement = document.createElement('img');
            imageElement.src = imageUrl;
            imageElement.alt = 'èŠå¤©å›¾ç‰‡';
            imageElement.onload = function() {
                // å›¾ç‰‡åŠ è½½å®Œæˆåæ»šåŠ¨åˆ°åº•éƒ¨
                scrollToBottom();
            };
            
            messageContent.appendChild(imageElement);
            messageDiv.appendChild(messageContent);
            chatMessages.appendChild(messageDiv);
            
            // æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
            scrollToBottom();
        }
        
        // å›¾ç‰‡ç”ŸæˆåŠŸèƒ½
        function showImageGenerationOptions() {
            const optionsDiv = document.getElementById('imageGenerationOptions');
            optionsDiv.style.display = 'block';
        }
        
        function hideImageGenerationOptions() {
            const optionsDiv = document.getElementById('imageGenerationOptions');
            optionsDiv.style.display = 'none';
        }
        
        // å›¾ç‰‡ç”Ÿæˆè¯·æ±‚é¢‘ç‡æ§åˆ¶
        let lastGenerateImageTime = 0;
        const GENERATE_IMAGE_COOLDOWN = 30000; // 30ç§’å†·å´æ—¶é—´
        
        async function generateImage() {
            // æ£€æŸ¥è¯·æ±‚é¢‘ç‡
            const now = Date.now();
            if (now - lastGenerateImageTime < GENERATE_IMAGE_COOLDOWN) {
                const remainingTime = Math.ceil((GENERATE_IMAGE_COOLDOWN - (now - lastGenerateImageTime)) / 1000);
                alert(`ç”Ÿæˆå›¾ç‰‡éœ€è¦ç­‰å¾… ${remainingTime} ç§’ï¼Œè¯·ç¨åå†è¯•ï¼`);
                return;
            }
            
            const prompt = document.getElementById('chatInput').value.trim();
            if (!prompt) {
                alert('è¯·è¾“å…¥å›¾ç‰‡ç”Ÿæˆæè¿°ï¼');
                return;
            }
            
            const size = document.getElementById('imageSize').value;
            
            // æ›´æ–°æœ€åè¯·æ±‚æ—¶é—´
            lastGenerateImageTime = now;
            
            // æ·»åŠ ç”¨æˆ·è¯·æ±‚åˆ°èŠå¤©è®°å½•
            addMessageToChat(`ç”Ÿæˆå›¾ç‰‡ï¼š${prompt}\nå°ºå¯¸ï¼š${size}`, 'user');
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('chatInput').value = '';
            
            // æ˜¾ç¤ºç”Ÿæˆä¸­æ¶ˆæ¯
            addMessageToChat('æ­£åœ¨ç”Ÿæˆå›¾ç‰‡ï¼Œè¯·ç¨å€™...', 'bot');
            
            // éšè—å›¾ç‰‡ç”Ÿæˆé€‰é¡¹
            hideImageGenerationOptions();
            
            try {
                // è°ƒç”¨æ™ºè°±AIå›¾åƒç”ŸæˆAPI
                const response = await fetch('https://open.bigmodel.cn/api/paas/v4/images/generations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_CONFIG.key}`
                    },
                    body: JSON.stringify({
                        model: 'cogview-4',
                        prompt: prompt,
                        size: size,
                        quality: 'standard',
                        watermark_enabled: true
                    })
                });
                
                if (!response.ok) {
                    if (response.status === 429) {
                        // è¯·æ±‚é¢‘ç‡è¿‡é«˜
                        addMessageToChat('æŠ±æ­‰ï¼Œå½“å‰è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•ã€‚\nå»ºè®®ç­‰å¾…30ç§’åå†æ¬¡å°è¯•ã€‚', 'bot');
                        return;
                    } else {
                        throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                    }
                }
                
                const data = await response.json();
                
                // è·å–ç”Ÿæˆçš„å›¾ç‰‡URL
                if (data.data && data.data.length > 0 && data.data[0].url) {
                    const generatedImageUrl = data.data[0].url;
                    
                    // æ·»åŠ ç”Ÿæˆçš„å›¾ç‰‡åˆ°èŠå¤©è®°å½•
                    addMessageToChat('å›¾ç‰‡ç”Ÿæˆå®Œæˆï¼', 'bot');
                    addImageToChat(generatedImageUrl, 'bot');
                } else {
                    throw new Error('APIè¿”å›æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                }
            } catch (error) {
                console.error('å›¾ç‰‡ç”Ÿæˆå¤±è´¥:', error);
                addMessageToChat('æŠ±æ­‰ï¼Œå›¾ç‰‡ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚\né”™è¯¯ä¿¡æ¯ï¼š' + error.message, 'bot');
            }
        }
        
        // è¯­éŸ³è½¬æ–‡æœ¬åŠŸèƒ½
        let audioFile = null;
        
        // æ‰“å¼€è¯­éŸ³è½¬æ–‡æœ¬å¼¹çª—
        function openSpeechToTextModal() {
            document.getElementById('speechToTextModal').classList.add('show');
        }
        
        // å…³é—­è¯­éŸ³è½¬æ–‡æœ¬å¼¹çª—
        function closeSpeechToTextModal() {
            document.getElementById('speechToTextModal').classList.remove('show');
            clearSpeechToText();
        }
        
        // å¤„ç†éŸ³é¢‘æ–‡ä»¶é€‰æ‹©
        function handleAudioFile(event) {
            audioFile = event.target.files[0];
            if (audioFile) {
                // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆ25MBé™åˆ¶ï¼‰
                if (audioFile.size > 25 * 1024 * 1024) {
                    alert('éŸ³é¢‘æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡25MBï¼');
                    audioFile = null;
                    document.getElementById('fileName').textContent = '';
                    document.getElementById('convertBtn').disabled = true;
                    document.getElementById('convertBtn').style.opacity = '0.6';
                    return;
                }
                
                // æ£€æŸ¥æ–‡ä»¶æ ¼å¼
                const allowedTypes = ['audio/wav', 'audio/mp3'];
                if (!allowedTypes.includes(audioFile.type)) {
                    alert('åªæ”¯æŒ.wavå’Œ.mp3æ ¼å¼çš„éŸ³é¢‘æ–‡ä»¶ï¼');
                    audioFile = null;
                    document.getElementById('fileName').textContent = '';
                    document.getElementById('convertBtn').disabled = true;
                    document.getElementById('convertBtn').style.opacity = '0.6';
                    return;
                }
                
                document.getElementById('fileName').textContent = `å·²é€‰æ‹©ï¼š${audioFile.name}`;
                document.getElementById('convertBtn').disabled = false;
                document.getElementById('convertBtn').style.opacity = '1';
            }
        }
        
        // æ¸…ç©ºè¯­éŸ³è½¬æ–‡æœ¬å†…å®¹
        function clearSpeechToText() {
            audioFile = null;
            document.getElementById('audioFile').value = '';
            document.getElementById('fileName').textContent = '';
            document.getElementById('speechResult').textContent = '';
            document.getElementById('convertBtn').disabled = true;
            document.getElementById('convertBtn').style.opacity = '0.6';
        }
        
        // å¼€å§‹è¯­éŸ³è½¬æ–‡æœ¬è½¬æ¢
        async function startSpeechToText() {
            if (!audioFile) {
                alert('è¯·å…ˆé€‰æ‹©éŸ³é¢‘æ–‡ä»¶ï¼');
                return;
            }
            
            // æ˜¾ç¤ºè½¬æ¢ä¸­çŠ¶æ€
            document.getElementById('speechResult').textContent = 'æ­£åœ¨è½¬æ¢ï¼Œè¯·ç¨å€™...';
            const convertBtn = document.getElementById('convertBtn');
            const originalText = convertBtn.textContent;
            convertBtn.disabled = true;
            convertBtn.textContent = 'â³ è½¬æ¢ä¸­...';
            convertBtn.style.opacity = '0.6';
            
            try {
                // è°ƒç”¨æ™ºè°±AIè¯­éŸ³è½¬æ–‡æœ¬API
                const result = await callSpeechToTextAPI(audioFile);
                document.getElementById('speechResult').textContent = result;
            } catch (error) {
                console.error('è¯­éŸ³è½¬æ–‡æœ¬å¤±è´¥:', error);
                document.getElementById('speechResult').textContent = `è½¬æ¢å¤±è´¥ï¼š${error.message}`;
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                convertBtn.disabled = false;
                convertBtn.textContent = originalText;
                convertBtn.style.opacity = '1';
            }
        }
        
        // è°ƒç”¨æ™ºè°±AIè¯­éŸ³è½¬æ–‡æœ¬API
        async function callSpeechToTextAPI(file) {
            const formData = new FormData();
            formData.append('model', 'glm-asr-2512');
            formData.append('file', file);
            formData.append('stream', 'false');
            
            const response = await fetch('https://open.bigmodel.cn/api/paas/v4/audio/transcriptions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${API_CONFIG.key}`
                },
                body: formData
            });
            
            if (!response.ok) {
                throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
            }
            
            const data = await response.json();
            return data.text;
        }
        
        // å¤åˆ¶è½¬æ¢ç»“æœ
        function copySpeechResult() {
            const result = document.getElementById('speechResult').textContent;
            if (!result || result === 'æ­£åœ¨è½¬æ¢ï¼Œè¯·ç¨å€™...') {
                alert('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹ï¼');
                return;
            }
            
            navigator.clipboard.writeText(result).then(() => {
                alert('å¤åˆ¶æˆåŠŸï¼');
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼');
            });
        }
        
        // ç›‘å¬ESCé”®å…³é—­è¯­éŸ³è½¬æ–‡æœ¬å¼¹çª—
        window.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const speechToTextModal = document.getElementById('speechToTextModal');
                if (speechToTextModal.classList.contains('show')) {
                    closeSpeechToTextModal();
                }
            }
        });
        
        // æ™ºèƒ½ä½“å¯¹è¯åŠŸèƒ½
        let currentAgent = null;
        let agentChatHistory = [];
        
        // æ˜¾ç¤ºæ™ºèƒ½ä½“é€‰æ‹©é¢æ¿
        function showAgentSelection() {
            // éšè—å›¾ç‰‡ç”Ÿæˆé€‰é¡¹
            hideImageGenerationOptions();
            // æ˜¾ç¤ºæ™ºèƒ½ä½“é€‰æ‹©é¢æ¿
            document.getElementById('agentSelectionOptions').style.display = 'block';
        }
        
        // éšè—æ™ºèƒ½ä½“é€‰æ‹©é¢æ¿
        function hideAgentSelection() {
            document.getElementById('agentSelectionOptions').style.display = 'none';
        }
        
        // å¤„ç†æ™ºèƒ½ä½“é€‰æ‹©å˜åŒ–
        function handleAgentChange() {
            const agentId = document.getElementById('agentSelect').value;
            const translationOptions = document.getElementById('translationOptions');
            
            // åªæœ‰ç¿»è¯‘ç›¸å…³æ™ºèƒ½ä½“æ‰æ˜¾ç¤ºç¿»è¯‘è®¾ç½®
            if (agentId.includes('translation')) {
                translationOptions.style.display = 'block';
            } else {
                translationOptions.style.display = 'none';
            }
        }
        
        // å¼€å§‹æ™ºèƒ½ä½“å¯¹è¯
        async function startAgentChat() {
            const agentId = document.getElementById('agentSelect').value;
            const chatInput = document.getElementById('chatInput');
            const message = chatInput.value.trim();
            
            if (!message) {
                alert('è¯·è¾“å…¥å¯¹è¯å†…å®¹ï¼');
                return;
            }
            
            currentAgent = agentId;
            
            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°èŠå¤©è®°å½•
            addMessageToChat(message, 'user');
            chatInput.value = '';
            
            // éšè—æ™ºèƒ½ä½“é€‰æ‹©é¢æ¿
            hideAgentSelection();
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoadingState();
            
            try {
                // æ„å»ºæ™ºèƒ½ä½“å¯¹è¯è¯·æ±‚
                const requestBody = {
                    agent_id: agentId,
                    messages: [...agentChatHistory, {
                        role: 'user',
                        content: message
                    }],
                    stream: false
                };
                
                // æ·»åŠ ç¿»è¯‘æ™ºèƒ½ä½“çš„ç‰¹æ®Šå‚æ•°
                if (agentId.includes('translation')) {
                    requestBody.custom_variables = {
                        source_lang: document.getElementById('sourceLang').value,
                        target_lang: document.getElementById('targetLang').value,
                        strategy: document.getElementById('translationStrategy').value
                    };
                }
                
                // è°ƒç”¨æ™ºèƒ½ä½“API
                const response = await fetch('https://open.bigmodel.cn/api/v1/agents', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_CONFIG.key}`
                    },
                    body: JSON.stringify(requestBody)
                });
                
                // å…ˆè·å–å“åº”æ•°æ®
                const data = await response.json();
                
                // éšè—åŠ è½½çŠ¶æ€
                hideLoadingState();
                
                // è°ƒè¯•ï¼šæ‰“å°å®Œæ•´å“åº”
                console.log('æ™ºèƒ½ä½“APIå“åº”:', data);
                
                // æ£€æŸ¥æ˜¯å¦ä¸ºå¤±è´¥çŠ¶æ€
                if (data.status === 'failed' || !response.ok) {
                    let errorMsg = 'æ™ºèƒ½ä½“è°ƒç”¨å¤±è´¥';
                    let errorDetails = '';
                    
                    // æå–é”™è¯¯ä¿¡æ¯
                    if (data.error) {
                        errorDetails = `${data.error.code} - ${data.error.message}`;
                        
                        // é’ˆå¯¹ä¸åŒé”™è¯¯ç æä¾›å‹å¥½æç¤º
                        if (data.error.code === '1113') {
                            // è´¦æˆ·ä½™é¢ä¸è¶³
                            errorMsg = 'æ™ºèƒ½ä½“è°ƒç”¨å¤±è´¥ï¼šè´¦æˆ·ä½™é¢ä¸è¶³';
                            errorDetails = 'è¯·å‰å¾€æ™ºè°±AIå¼€æ”¾å¹³å°å……å€¼åå†è¯•';
                        } else if (data.error.code === '1114') {
                            // æ¥å£è°ƒç”¨é¢‘ç‡é™åˆ¶
                            errorMsg = 'æ™ºèƒ½ä½“è°ƒç”¨å¤±è´¥ï¼šè°ƒç”¨é¢‘ç‡è¿‡é«˜';
                            errorDetails = 'è¯·ç¨åå†è¯•';
                        } else if (data.error.code === '1101') {
                            // API Key æ— æ•ˆ
                            errorMsg = 'æ™ºèƒ½ä½“è°ƒç”¨å¤±è´¥ï¼šAPIå¯†é’¥æ— æ•ˆ';
                            errorDetails = 'è¯·æ£€æŸ¥APIå¯†é’¥é…ç½®';
                        }
                    } else {
                        errorDetails = `${response.status} - ${response.statusText}`;
                    }
                    
                    throw new Error(`${errorMsg} - ${errorDetails}`);
                }
                
                // å°è¯•å¤šç§å“åº”æ ¼å¼è§£æ
                if (data.choices && data.choices.length > 0) {
                    const choice = data.choices[0];
                    
                    // æ ¼å¼1: choices[0].messages
                    if (choice.messages && choice.messages.length > 0) {
                        for (const msg of choice.messages) {
                            if (msg.content) {
                                // å¤„ç†ä¸åŒç±»å‹çš„content
                                let content = '';
                                if (typeof msg.content === 'string') {
                                    content = msg.content;
                                } else if (msg.content.text) {
                                    content = msg.content.text;
                                } else if (Array.isArray(msg.content)) {
                                    // å¤„ç†å¤šæ¨¡æ€å†…å®¹
                                    content = msg.content.map(item => item.text || '').join(' ');
                                } else {
                                    content = JSON.stringify(msg.content);
                                }
                                addMessageToChat(content, 'bot');
                                agentChatHistory.push(msg);
                            }
                        }
                        return;
                    }
                    
                    // æ ¼å¼2: choices[0].message (å•ä¸ªæ¶ˆæ¯)
                    if (choice.message && choice.message.content) {
                        const msg = choice.message;
                        let content = '';
                        if (typeof msg.content === 'string') {
                            content = msg.content;
                        } else if (msg.content.text) {
                            content = msg.content.text;
                        } else if (Array.isArray(msg.content)) {
                            content = msg.content.map(item => item.text || '').join(' ');
                        } else {
                            content = JSON.stringify(msg.content);
                        }
                        addMessageToChat(content, 'bot');
                        agentChatHistory.push(msg);
                        return;
                    }
                }
                
                // æ ¼å¼3: ç›´æ¥è¿”å›content
                if (data.content) {
                    let content = '';
                    if (typeof data.content === 'string') {
                        content = data.content;
                    } else {
                        content = JSON.stringify(data.content);
                    }
                    addMessageToChat(content, 'bot');
                    agentChatHistory.push({ role: 'assistant', content: content });
                    return;
                }
                
                // æ ¼å¼4: æ£€æŸ¥æ˜¯å¦æœ‰ç›´æ¥çš„å“åº”æ¶ˆæ¯
                if (data.message) {
                    let content = '';
                    if (typeof data.message === 'string') {
                        content = data.message;
                    } else if (data.message.content) {
                        if (typeof data.message.content === 'string') {
                            content = data.message.content;
                        } else {
                            content = JSON.stringify(data.message.content);
                        }
                    } else {
                        content = JSON.stringify(data.message);
                    }
                    addMessageToChat(content, 'bot');
                    agentChatHistory.push({ role: 'assistant', content: content });
                    return;
                }
                
                // å¦‚æœéƒ½ä¸åŒ¹é…ï¼ŒæŠ›å‡ºé”™è¯¯å¹¶æ˜¾ç¤ºåŸå§‹å“åº”
                throw new Error(`æ™ºèƒ½ä½“å“åº”æ ¼å¼ä¸æ­£ç¡®ï¼ŒåŸå§‹å“åº”ï¼š${JSON.stringify(data)}`);
            } catch (error) {
                console.error('æ™ºèƒ½ä½“å¯¹è¯å¤±è´¥:', error);
                hideLoadingState();
                addMessageToChat(`æ™ºèƒ½ä½“å¯¹è¯å¤±è´¥ï¼š${error.message}`, 'bot');
            }
        }
    </script>
    <!--Start of Gullchat.com Script-->
    <script id="gullchat-widget-js" src="https://code.gullchat.com/widget.js?mode=production&wid=693ea57a0ee55c23ceff491f&pid=693ea2fc328f7e8be297b5dc&fm=normal&lt=default"></script>
    <!--End of Gullchat.com Script-->
    
    <!-- æƒé™ç éªŒè¯å¼¹çª— -->
    <div class="permission-modal" id="permissionModal">
        <div class="permission-modal-content">
            <h3>å·¥å…·è®¿é—®æƒé™éªŒè¯</h3>
            <p>è¯·è¾“å…¥è®¿é—®æƒé™ç ï¼Œä»¥è®¿é—®è¯¥å·¥å…·</p>
            <div class="permission-input-group">
                <label for="permissionCode">è®¿é—®æƒé™ç </label>
                <input type="text" id="permissionCode" placeholder="è¯·è¾“å…¥è®¿é—®æƒé™ç ">
            </div>
            <!-- æƒé™ç è·å–æç¤º -->
            <p style="font-size: 14px; color: #fa709a; text-align: center; margin-top: 15px; padding: 10px; background-color: #fff3f6; border-radius: 4px;">
                ğŸ’¡ æç¤ºï¼šè®¿é—®æƒé™ç å¯é€šè¿‡å…³æ³¨æˆ‘ä»¬çš„å¾®ä¿¡å…¬ä¼—å·è·å–ï¼Œå›å¤ã€Œæƒé™ç ã€å³å¯è·å¾—ã€‚
            </p>
            <div class="permission-modal-buttons">
                <button class="btn-primary" onclick="verifyPermissionCode()">éªŒè¯</button>
                <button class="btn-cancel" onclick="closePermissionModal()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    
    <!-- AIèŠå¤©å¼¹çª— -->
    <div class="chat-modal" id="chatModal">
        <div class="chat-modal-content">
            <!-- èŠå¤©å¤´éƒ¨ -->
            <div class="chat-header">
                <h3>
                    <div class="bot-avatar">ğŸ¤–</div>
                    å¤©é©¬è¡Œç©ºåˆ›æ„å°åŠ©æ‰‹
                </h3>
                <button class="chat-close-btn" onclick="closeChatModal()">Ã—</button>
            </div>
            
            <!-- èŠå¤©æ¶ˆæ¯åŒºåŸŸ -->
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message bot-message">
                    <div class="message-content">
                        <p>ä½ å¥½ï¼æˆ‘æ˜¯å¤©é©¬è¡Œç©ºåˆ›æ„å°åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ</p>
                    </div>
                </div>
            </div>
            
            <!-- èŠå¤©è¾“å…¥åŒºåŸŸ -->
            <div class="chat-input-area">
                <div class="chat-input-toolbar">
                    <button class="chat-tool-btn" id="uploadImageBtn" title="ä¸Šä¼ å›¾ç‰‡" onclick="triggerImageUpload()">
                        <span class="tool-btn-icon">ğŸ“·</span>
                        <span class="tool-btn-label">ä¸Šä¼ </span>
                    </button>
                    <button class="chat-tool-btn" id="generateImageBtn" title="ç”Ÿæˆå›¾ç‰‡" onclick="showImageGenerationOptions()">
                        <span class="tool-btn-icon">ğŸ¨</span>
                        <span class="tool-btn-label">ç”Ÿæˆ</span>
                    </button>
                    <button class="chat-tool-btn" id="agentChatBtn" title="æ™ºèƒ½ä½“å¯¹è¯" onclick="showAgentSelection()">
                        <span class="tool-btn-icon">ğŸ¤–</span>
                        <span class="tool-btn-label">æ™ºèƒ½ä½“</span>
                    </button>
                    <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                </div>
                <div class="chat-input-main">
                    <input type="text" id="chatInput" placeholder="è¯·è¾“å…¥ä½ çš„é—®é¢˜..." autocomplete="off">
                    <button class="chat-send-btn" onclick="sendMessage()">å‘é€</button>
                </div>
            </div>
            
            <!-- å›¾ç‰‡ç”Ÿæˆé€‰é¡¹ -->
            <div class="image-generation-options" id="imageGenerationOptions" style="display: none;">
                <h4>å›¾ç‰‡ç”Ÿæˆé€‰é¡¹</h4>
                <div class="image-option-group">
                    <label>é£æ ¼ï¼š</label>
                    <select id="imageStyle">
                        <option value="realistic">å†™å®é£æ ¼</option>
                        <option value="anime">åŠ¨æ¼«é£æ ¼</option>
                        <option value="cartoon">å¡é€šé£æ ¼</option>
                        <option value="abstract">æŠ½è±¡é£æ ¼</option>
                    </select>
                </div>
                <div class="image-option-group">
                    <label>å°ºå¯¸ï¼š</label>
                    <select id="imageSize">
                        <option value="512x512">512x512</option>
                        <option value="768x768">768x768</option>
                        <option value="1024x1024">1024x1024</option>
                    </select>
                </div>
                <div class="image-option-actions">
                    <button class="image-generate-btn" onclick="generateImage()">ç”Ÿæˆå›¾ç‰‡</button>
                    <button class="image-cancel-btn" onclick="hideImageGenerationOptions()">å–æ¶ˆ</button>
                </div>
            </div>
            
            <!-- æ™ºèƒ½ä½“é€‰æ‹©é¢æ¿ -->
            <div class="image-generation-options" id="agentSelectionOptions" style="display: none;">
                <h4>æ™ºèƒ½ä½“é€‰æ‹©</h4>
                <div class="image-option-group">
                    <label>é€‰æ‹©æ™ºèƒ½ä½“ï¼š</label>
                    <select id="agentSelect" onchange="handleAgentChange()">
                        <option value="general_translation">é€šç”¨ç¿»è¯‘æ™ºèƒ½ä½“</option>
                        <option value="slides_glm_agent">å¹»ç¯ç‰‡æ™ºèƒ½ä½“</option>
                        <option value="cartoon_generator_agent">å¡é€šç”Ÿæˆæ™ºèƒ½ä½“</option>
                        <option value="ai_drawing_agent">AIç»˜ç”»æ™ºèƒ½ä½“</option>
                        <option value="receipt_recognition_agent">æ”¶æ®è¯†åˆ«æ™ºèƒ½ä½“</option>
                        <option value="clothes_recognition_agent">è¡£ç‰©è¯†åˆ«æ™ºèƒ½ä½“</option>
                        <option value="contract_parser_agent">åˆåŒè§£ææ™ºèƒ½ä½“</option>
                        <option value="service_check_agent">æœåŠ¡æ£€æŸ¥æ™ºèƒ½ä½“</option>
                        <option value="subtitle_translation_agent">å­—å¹•ç¿»è¯‘æ™ºèƒ½ä½“</option>
                        <option value="intelligent_education_correction_agent">æ™ºèƒ½æ•™è‚²æ‰¹æ”¹æ™ºèƒ½ä½“</option>
                        <option value="job_matching_agent">èŒä½åŒ¹é…æ™ºèƒ½ä½“</option>
                        <option value="social_translation_agent">ç¤¾äº¤ç¿»è¯‘æ™ºèƒ½ä½“</option>
                        <option value="social_literature_translation_agent">ç¤¾ä¼šæ–‡çŒ®ç¿»è¯‘æ™ºèƒ½ä½“</option>
                        <option value="intelligent_education_solve_agent">æ™ºèƒ½æ•™è‚²è§£é¢˜æ™ºèƒ½ä½“</option>
                        <option value="vidu_template_agent">Viduæ¨¡æ¿æ™ºèƒ½ä½“</option>
                        <option value="bidwin_parser_agent">æ ‡ä¹¦è§£ææ™ºèƒ½ä½“</option>
                    </select>
                </div>
                <div class="image-option-group" id="translationOptions" style="display: none;">
                    <h5>ç¿»è¯‘è®¾ç½®</h5>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 10px 0;">
                        <div>
                            <label>æºè¯­è¨€ï¼š</label>
                            <select id="sourceLang">
                                <option value="auto">è‡ªåŠ¨æ£€æµ‹</option>
                                <option value="zh-CN">ä¸­æ–‡</option>
                                <option value="en">è‹±è¯­</option>
                                <option value="ja">æ—¥è¯­</option>
                                <option value="ko">éŸ©è¯­</option>
                                <option value="fr">æ³•è¯­</option>
                                <option value="de">å¾·è¯­</option>
                                <option value="es">è¥¿ç­ç‰™è¯­</option>
                            </select>
                        </div>
                        <div>
                            <label>ç›®æ ‡è¯­è¨€ï¼š</label>
                            <select id="targetLang">
                                <option value="zh-CN">ä¸­æ–‡</option>
                                <option value="en">è‹±è¯­</option>
                                <option value="ja">æ—¥è¯­</option>
                                <option value="ko">éŸ©è¯­</option>
                                <option value="fr">æ³•è¯­</option>
                                <option value="de">å¾·è¯­</option>
                                <option value="es">è¥¿ç­ç‰™è¯­</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label>ç¿»è¯‘ç­–ç•¥ï¼š</label>
                        <select id="translationStrategy">
                            <option value="general">é€šç”¨ç¿»è¯‘</option>
                            <option value="cot">æ€è€ƒé“¾ç¿»è¯‘</option>
                        </select>
                    </div>
                </div>
                <div class="image-option-actions">
                    <button class="image-generate-btn" onclick="startAgentChat()">å¼€å§‹å¯¹è¯</button>
                    <button class="image-cancel-btn" onclick="hideAgentSelection()">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- è¯­éŸ³è½¬æ–‡æœ¬å¼¹çª— -->
    <div class="chat-modal" id="speechToTextModal">
        <div class="chat-modal-content">
            <div class="chat-header">
                <h3><div class="bot-avatar">ğŸ¤</div> è¯­éŸ³è½¬æ–‡æœ¬</h3>
                <button class="chat-close-btn" onclick="closeSpeechToTextModal()">&times;</button>
            </div>
            <div class="chat-messages" id="speechToTextMessages" style="padding: 20px;">
                <div class="speech-input-section" style="margin-bottom: 20px;">
                    <h4 style="color: #333; margin-bottom: 15px; font-size: 16px;">ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶</h4>
                    <p style="color: #666; margin-bottom: 15px; font-size: 14px;">æ”¯æŒ .wav / .mp3 æ ¼å¼ï¼Œæ–‡ä»¶å¤§å° â‰¤ 25 MBï¼ŒéŸ³é¢‘æ—¶é•¿ â‰¤ 30 ç§’</p>
                    <div style="text-align: center; padding: 20px; border: 2px dashed #ccc; border-radius: 8px; margin-bottom: 15px;">
                        <input type="file" id="audioFile" accept="audio/wav,audio/mp3" style="display: none;" onchange="handleAudioFile(event)">
                        <button onclick="document.getElementById('audioFile').click()" style="padding: 12px 24px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 16px; font-weight: 500; transition: all 0.3s ease;">
                            ğŸ“ é€‰æ‹©éŸ³é¢‘æ–‡ä»¶
                        </button>
                        <div id="fileName" style="margin-top: 10px; color: #666; font-size: 14px;"></div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 20px;">
                        <button onclick="startSpeechToText()" id="convertBtn" disabled style="padding: 12px 30px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 16px; font-weight: 500; transition: all 0.3s ease; opacity: 0.6;">
                            ğŸ”„ å¼€å§‹è½¬æ¢
                        </button>
                        <button onclick="clearSpeechToText()" style="padding: 12px 30px; background: #f0f0f0; color: #333; border: none; border-radius: 20px; cursor: pointer; font-size: 16px; font-weight: 500; transition: all 0.3s ease;">
                            ğŸ—‘ï¸ æ¸…ç©º
                        </button>
                    </div>
                </div>
                
                <div class="speech-result-section" style="margin-top: 20px;">
                    <h4 style="color: #333; margin-bottom: 15px; font-size: 16px;">è½¬æ¢ç»“æœ</h4>
                    <div id="speechResult" style="background-color: #f7f8fa; padding: 15px; border-radius: 8px; min-height: 100px; border: 1px solid #e5e6eb; font-size: 14px; line-height: 1.5; white-space: pre-wrap; word-wrap: break-word;"></div>
                    <div style="margin-top: 10px; text-align: right;">
                        <button onclick="copySpeechResult()" style="padding: 8px 16px; background: #f0f0f0; color: #333; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; transition: all 0.3s ease;">
                            ğŸ“‹ å¤åˆ¶ç»“æœ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>